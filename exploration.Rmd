---
title: "exploration"
author: "Jordan Boswell and Thuy Nguyen"
date: "2/26/2022"
output: html_document
---


```{r}
library(rigr)
library(tidyverse)
library(randomForest)
library(caret)
```


# Read data and format columns
```{r}
ship <- read.csv("train.csv")

ship$GID <- as.integer(substr(ship$PassengerId, 1,4))

ship$IID <- as.integer(substr(ship$PassengerId,6,8))

ship$GroupSize <- sapply(ship$GID, function(x){sum(ship$GID == x)})

ship$HomePlanet <- as.factor(ship$HomePlanet)

ship$CryoSleep <- as.logical(ship$CryoSleep)

ship$Deck <- as.character(mapply(function(x,y){if(nchar(x)==0){NULL}else{substr(x,y[2],y[3]-2)}},
                      ship$Cabin,
                      regexec("(.*?)/(.*?)/(.*)", ship$Cabin)))
ship$Num <- as.character(mapply(function(x,y){if(nchar(x)==0){NULL}else{substr(x,y[3],y[4]-2)}},
                      ship$Cabin,
                      regexec("(.*?)/(.*?)/(.*)", ship$Cabin)))
ship$Side <- as.character(mapply(function(x,y){if(nchar(x)==0){NULL}else{substr(x,y[4],nchar(x))}},
                      ship$Cabin,
                      regexec("(.*?)/(.*?)/(.*)", ship$Cabin)))
ship$Cabin <- sapply(ship$Cabin, function(x){if (x=="") NA else x})

ship$Destination <- as.factor(ship$Destination)

ship$Age <- as.integer(ship$Age)

ship$VIP <- as.logical(ship$VIP)

ship$Transported <- as.logical(ship$Transported)

updateSpending <- function(df){
  rsna <- is.na(df$RoomService)
  fcna <- is.na(df$FoodCourt)
  smna <- is.na(df$ShoppingMall)
  sna <- is.na(df$Spa)
  vrdna <- is.na(df$VRDeck)
  allna <- rsna & fcna & smna & sna & vrdna
  df$Spending <- ifelse(allna, NA, ifelse(rsna, 0, df$RoomService) + ifelse(fcna, 0, df$FoodCourt) + ifelse(smna, 0, df$ShoppingMall) + ifelse(sna, 0, df$Spa) + ifelse(vrdna, 0, df$VRDeck))
  df$HasSpent <- df$Spending > 0
  rm(rsna, fcna, smna, sna, vrdna, allna)
}
updateSpending(ship)
```


# Fixing missing data
## Change empty strings to NA
```{r}
ship$HomePlanet[ship$HomePlanet==""] <- NA
ship$Destination[ship$Destination==""] <- NA
ship$Name[ship$Name==""] <- NA
```

## Cryosleep implies 0 spending
### Evidence
```{r}
ship[ship$CryoSleep %in% T, c("RoomService", "FoodCourt", "ShoppingMall", "Spa", "VRDeck")]
```
### Update
MAKE THIS A FUNCTION AND CALL
```{r}
ship[ship$CryoSleep %in% T, c("RoomService", "FoodCourt", "ShoppingMall", "Spa", "VRDeck")] <- 0
updateSpending(ship)
```

## Young children (Age <= 12) don't spend money
### Evidence
FIX THIS
```{r}
spending <- ship$Spending
for (age in 1:15){
  print(paste0(100.0 * nrow(subset(ship, !is.na(Age) & Age==age & !is.na(spending) & spending==0)) / nrow(subset(ship, !is.na(Age) & Age==age & !is.na(spending))), "% of people age ", age, " have 0 total spending"))
}
```
### Update
```{r}
ship[!is.na(ship$Age) & ship$Age <= 12, c("RoomService", "FoodCourt", "ShoppingMall", "Spa", "VRDeck")] <- 0
```

## Hypothesis: People in the same group of at least 2 members live in the same Deck for cabins A, B, C
```{r}
cmplt <- complete.cases(ship[,c("GID", "Cabin")])
deck <- NULL
for(i in 1: nrow(ship)){
  if (cmplt[i] == FALSE) next
  for(j in i:nrow(ship)){
    if(cmplt[j] ==FALSE) next
    if(ship$GID[i]== ship$GID[j] & ship$Cabin[i] !=ship$Cabin[j])
        deck <-c(deck,ship$Deck[i], ship$Deck[j])
  }
}
```
```{r}

for ( j in c("A","B","C","D","E","F", "G","T")){
  for (i in 1: length(deck)){
   
  }
   print(paste0("proportion of",j, "=" , sum(deck==j)/length(deck)))
}

```



0.2% of members of groups who live in cabin A share members with other cabin (Same with B, and C). Fill out the missing cabin for those who have other members live in cabin A,B, C.


#  Spending- vip- Cryosleep:  0%  of people who NOT VIP, but spend some money sleep

```{r}
table(ship$CryoSleep[ship$VIP =="FALSE" & spending >0])

```

```{r}
ship[ship$VIP== "FALSE" & spending>0, "CryoSleep"] <- "False"
```

